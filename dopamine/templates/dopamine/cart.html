{% extends 'dopamine/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<link href="{% static 'dopamine/css/cart.css' %}" rel="stylesheet" />
<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
{% comment %} const csrftoken = getCookie('csrftoken'); {% endcomment %}
{% comment %} const user = '{{ request.user }}'; {% endcomment %}
</script>

<div class="container d-flex justify-content-between mt-5">
  <!-- B·∫£ng s·∫£n ph·∫©m -->
  <div class="cart-left col-md-8">
    {% if items %}
      <table class="table cart-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Item</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
        {% for item in items %}
        <tr>
          <td><img class="cart-img" src="{{ item.product.ImageProduct }}" alt="{{ item.product.name }}"></td>
          <td>{{ item.product.name }}</td>
          
          <!-- Gi√° s·∫£n ph·∫©m -->
          <td>
            {{ item.product.price|floatformat:"g"|intcomma }} ƒë
          </td>
          
          <!-- N√∫t tƒÉng gi·∫£m s·ªë l∆∞·ª£ng -->
          <td>
            <div class="quantity-box">
              <button data-product="{{ item.product.id }}" data-action="remove" class="chg-quantity">‚àí</button>
              <span class="qty">{{ item.quantity }}</span>
              <button data-product="{{ item.product.id }}" data-action="add" class="chg-quantity">+</button>
            </div>
          </td>
          
          <!-- T·ªïng ti·ªÅn cho item -->
          <td>
            {{ item.get_total|floatformat:"g"|intcomma }} ƒë
          </td>
        </tr>
        {% endfor %}
      </tbody>
      </table>
    {% else %}
      <div class="alert alert-info text-center p-4 bg-white shadow rounded">
        <strong>üõí Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng!</strong>
      </div>
    {% endif %}
  </div>

  <!-- Cart Total b√™n ph·∫£i -->
 <div class="cart-summary-box shadow-lg p-4 rounded">
  <h4 class="text-center mb-4">üßæ Cart Total</h4>
  <p class="d-flex justify-content-between">
    <span>Items:</span> <strong>{{ order.get_cart_items }}</strong>
  </p>
  <p class="d-flex justify-content-between mb-3">
    <span>Total:</span>
    <strong class="text-danger">
      {{ order.get_cart_total|floatformat:"g"|intcomma }} ƒë
    </strong>
  </p>
  <hr>
  <a href="{% url 'checkout' %}" class="btn btn-success btn-block w-100 mt-3 fw-bold">üõçÔ∏è Thanh to√°n</a>
</div>

{% endblock content %}
